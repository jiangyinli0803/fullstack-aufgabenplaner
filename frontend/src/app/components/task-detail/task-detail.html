   <!-- ÈîôËØØÊèêÁ§∫ -->
  <div *ngIf="error$ | async as error">
    <p>error: {{ error }}</p>
  </div> 
  <div *ngIf="loading$  | async as loading">
    <p>Loading: {{ loading }}</p>
  </div>

<div class="mx-auto p-6">
  <div class="bg-white rounded-2xl shadow-md p-8" *ngIf="task">
    <h1  class="text-3xl font-bold mb-6" *ngIf="!isEditMode">Aufgabe Details</h1>
    <h1  class="text-3xl font-bold mb-6" *ngIf="isEditMode">Aufgabe Bearbeiten</h1>

    <div class="mb-6">
      <label class="text-gray-600 text-sm font-semibold">Aufgabentitel</label>
      <p class="text-lg font-bold" *ngIf="!isEditMode">{{ task.title }}</p>
      <input 
        *ngIf="isEditMode"
        [(ngModel)]="editedTask!.title"
        class="text-lg font-bold border-2 border-blue-300 rounded px-3 py-1 w-full mr-4"
        type="text">      
      
    </div>

    <div class="mb-6">
      <label class="text-gray-600 text-sm font-semibold">Beschreibung</label>
      <p class="text-lg" *ngIf="!isEditMode">{{ task.description }}</p>
      <textarea 
        *ngIf="isEditMode"
        [(ngModel)]="editedTask!.description"
        class="text-lg border-2 border-blue-300 rounded px-3 py-2 w-full"
        rows="3"></textarea>
    </div>
    
    
    <div class="grid grid-cols-2 gap-6 mb-4">
       <!--************************Mitarbeiter***********************-->
      <div>
        <label class="text-gray-600 text-sm font-semibold">Bearbeiter</label>
        <p class="text-lg" *ngIf="!isEditMode">{{ employee?.full_name || 'Nicht zugewiesen' }}</p>
        <select 
          *ngIf="isEditMode"
         [value]="editedTask?.employee?.id || ''"
         (change)="onEmployeeChange($any($event.target).value)"        
          class="text-lg border-2 border-blue-300 rounded px-3 py-1 w-full">
          <option [value]="null">Bitte w√§hlen</option>
          <option *ngFor="let emp of employees$ | async" [value]="emp.id">{{emp.full_name}}</option>          
        </select>
      </div>
      
      <div>
        <label class="text-gray-600 text-sm font-semibold">Abteilung</label>
        <p class="text-lg" *ngIf="!isEditMode">{{ employee?.department || '-' }}</p>
        <p class="text-lg border-2 border-gray-300 px-3 py-1 w-full" *ngIf="isEditMode">{{ employee?.department || '-' }}</p>
      </div>
    
       <!--************************Datum***********************-->
      <div>
        <label class="text-gray-600 text-sm font-semibold">Startdatum</label>
        <p class="text-lg" *ngIf="!isEditMode">{{ task.start_date }}</p>
        <input 
          *ngIf="isEditMode"
          [(ngModel)]="editedTask!.start_date"
          (ngModelChange)="updateDuration()"
          type="date"
          class="text-lg border-2 border-blue-300 rounded px-3 py-1 w-full">
      </div>
      
      <div>
        <label class="text-gray-600 text-sm font-semibold">Enddatum</label>
        <p class="text-lg" *ngIf="!isEditMode">{{ task.end_date }}</p>
        <input 
          *ngIf="isEditMode"
          [(ngModel)]="editedTask!.end_date"
          (ngModelChange)="updateDuration()"
          type="date"
          class="text-lg border-2 border-blue-300 rounded px-3 py-1 w-full">
      </div>

      <!--************************STATUS***********************-->
      <div>
        <label class="text-gray-600 text-sm font-semibold">Status</label>
        <p class="text-lg" *ngIf="!isEditMode">{{ task.status }}</p>
        <select 
          *ngIf="isEditMode"
          [(ngModel)]="editedTask!.status"
          class="text-lg border-2 border-blue-300 rounded px-3 py-1 w-full">        
          <option value="nicht-zugewiesen">Nicht zugewiesen</option>
          <option value="offen">Offen</option>
          <option value="abgeschlossen">Abgeschlossen</option>
          <option value="archiviert">Archiviert</option>
        </select>
      </div>
      
      <div>
        <label class="text-gray-600 text-sm font-semibold">Dauer/Tage</label>
        <p class="text-lg" *ngIf="!isEditMode">{{ duration || '‚Äì' }}</p>
        <p class="text-lg border-2 border-gray-300 rounded px-3 py-1 w-full" *ngIf="isEditMode">
           {{ duration || '‚Äì' }} </p>   
        <!-- üîî ÈîôËØØÊèêÁ§∫ -->
        <p *ngIf="dateError" class="text-red-500 text-sm mt-1">
          {{ dateError }}
        </p>      
      </div>

    <!-- ÊµãËØï‰∫∫ÂëòÈÉ®ÂàÜ -->
    <div>
    <label class="text-gray-600 text-sm font-semibold">Tester</label>    
    <div>      
      <p class="text-lg" *ngIf="!isEditMode">{{ selectedTester?.full_name || 'Kein Tester zugewiesen' }}</p>
    
    <!-- ÁºñËæëÊ®°ÂºèÔºöÈÄâÊã©ÊµãËØï‰∫∫Âëò -->
    <select 
      *ngIf="isEditMode"
      [(ngModel)]="editedTask!.tester"     
      class="text-lg border-2 border-blue-300 rounded px-3 py-2 w-full">
      <option [ngValue]="undefined">Kein Tester zuweisen</option>
      <option *ngFor="let emp of employees$ | async" [ngValue]="emp.id">
        {{ emp.full_name }}
      </option>
    </select>
    </div>
    </div> 
    
    <!-- Version-->
      <div>
        <label class="text-gray-600 text-sm font-semibold">Version</label>
        <p class="text-lg" *ngIf="!isEditMode">{{ task.version || 'v1.0' }}</p>
        <select 
          *ngIf="isEditMode && editedTask"          
          class="text-lg border-2 border-blue-300 rounded px-3 py-2 w-full" 
          [(ngModel)]="editedTask.version" 
          name="version">          
          <option *ngFor="let version of availableVersions" [value]="version">
            {{ version }}
          </option>
        </select>
      </div>

    </div>     
    
    <!-- ÊåâÈíÆ --> 
    <div class="my-8 flex gap-4">
      <button 
        *ngIf="!isEditMode"
        (click)="goBack()"
        class="px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition cursor-pointer">
        Zur√ºck zur Liste
      </button>

      <button 
        *ngIf="!isEditMode"
        (click)="enterEditMode()"
        class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition cursor-pointer">
        Bearbeiten
      </button>

      <button 
        *ngIf="isEditMode"
        (click)="saveChanges()"
        class="px-6 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition cursor-pointer">
        Speichern
      </button>

      <button 
        *ngIf="isEditMode"
        (click)="cancelEdit()"
        class="px-6 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition cursor-pointer">
        Abbrechen
      </button>
    </div>

    <!-- commentÈÉ®ÂàÜ -->
    <div class="mb-8 border-t pt-6">
      <h2 class="text-xl font-bold mb-4">Kommentare</h2>
      <div class="bg-gray-50 p-4 rounded-lg border border-gray-400 mb-2"
           *ngFor="let comment of task.comments">
           <div class="flex justify-between">
                <span class="font-semibold text-gray-700">{{ comment.author_name }}</span>
                <span class="text-gray-500">{{ formatTimestamp(comment.updated_at) }}</span>
           </div>
           <div class="bg-gray-300 my-2 p-2"> {{comment.text}}</div>
            <!-- Âè™Êúâ‰ΩúËÄÖÊú¨‰∫∫ÂèØ‰ª•‰øÆÊîπ -->
            <button *ngIf="isCommentAuthor(comment)"
              (click)="deleteComment(comment.id)"
              class="px-4 py-2 text-sm bg-red-500 hover:bg-red-600 text-white rounded-lg transition cursor-pointer">
              L√∂schen
            </button>            
      </div>

        <p *ngIf="!task.comments" 
           class="text-gray-700 text-sm mb-4">
          Noch keine Kommentare
        </p>
      

      <!-- Ê∑ªÂä†Êñ∞ËØÑËÆ∫ -->
      <div *ngIf="!isEditMode" class="bg-blue-50 p-4 rounded-lg border border-blue-200">
        <label class="text-gray-700 text-sm font-semibold mb-2 block">Neuer Kommentar</label>
        <textarea 
          [(ngModel)]="newCommentText"
          class="w-full border-2 border-blue-300 rounded px-3 py-2 mb-3 focus:outline-none focus:border-blue-500"
          rows="3"
          placeholder="Schreiben Sie einen Kommentar..."></textarea>
        <button 
          (click)="addComment()"
          [disabled]="!newCommentText.trim()"
          class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition disabled:bg-gray-300 disabled:cursor-not-allowed">
          Kommentar hinzuf√ºgen
        </button>
      </div>

</div>


      </div>
    
</div>